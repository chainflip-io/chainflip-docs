---

title: Vault swaps for Ethereum and Arbitrum

description: Description of performing Vault Swaps for EVM networks

---

import { Callout } from "@/components";


## Vault swaps for Ethereum and Arbitrum

### Overview

The Vault smart contract, besides holding assets, acts as an entry point for starting a swap without requiring a [deposit address](../javascript-sdk/swap-assets/request-deposit-address/v2). Furthermore, for cross-chain messaging swaps, the Vault will call the destination address with a particular function signature.

<Callout type="info">
For more information, learn [How Swapping Works](../../how-swapping-works.mdx).
</Callout>

### Using the broker API for EVM Vault swaps

#### Requesting the payload via Broker API

TODO: Add information on how to use the broker API for EVM Vault swaps - under development.

#### Signing EVM transaction payload

The `cf_get_vault_swap_details` RPC call for EVM returns the data that will initiate a Vault swap via call to Chainflip's Vault smart contract. That contains the `data`, `value`, and `to` fields that shall be used to create and sign a transaction. Other values such as `gas` or `gasPrice` can be estimated and set by the user or wallet.

```typescript copy
import BigNumber from 'bignumber.js';
import Web3 from 'web3';

interface EvmVaultSwapDetails {
  chain: 'Ethereum' | 'Arbitrum';
  calldata: string;
  value: string;
  to: string;
}

const vaultSwapDetails = (await chainflip.rpc(
  `cf_get_vault_swap_details`,
    broker_address,
    source_asset,
    destination_asset,
    destination_address,
    broker_commission,
    extra_parameters,
    channel_metadata,
    boost_fee,
    affiliate_fees,
    dca_parameters,
)) as unknown as EvmVaultSwapDetails;

const web3 = new Web3("your-endpoint");
const tx = {
  to: vaultSwapDetails.to,
  data: vaultSwapDetails.calldata,
  value: new BigNumber(vaultSwapDetails.value.slice(2), 16).toString(),
};

// Send and sign using the preferred method, this is just a simple example
const signedTx = await web3.eth.accounts.signTransaction(tx, evmWallet.privateKey);
const receipt = await web3.eth.sendSignedTransaction(signedTx.rawTransaction as string);
```

### Vault contract interface references


#### Initiate simple swap

To make a swap the user needs to call swap on the Vault of the source chain, specifying the parameters described in the table below. In the case of swapping ERC-20 tokens an **approval is required**.

| Param         | Description                                                                                                     | Data Type  |
|---------------|-----------------------------------------------------------------------------------------------------------------|------------|
| `dstChain`    | Destination chain for the swap                                                                                  | `uint32`   |
| `dstAddress`  |  Address where the swapped tokens will be sent to on the destination
        chain. Addresses must be encoded into a bytes type valid for the destination chain.
        You can check out a reference on how to do address encoding for each of the chains
        from our [SDK](https://github.com/chainflip-io/chainflip-sdk-monorepo/blob/67d43db80d734a206dd2a0cc8334cb118c711906/packages/shared/src/vault/executeSwap.ts#L31) | `address`  |
| `dstToken`    | Token to be received on the destination chain                                                                   | `uint32`   |
| `srcToken`    | Address of the token to be swapped from the source chain                                                        | `address`  |
| `amount`      | Amount of the source token to be swapped. When swapping a native asset, the `msg.value` passed in the call will be used instead. | `uint`     |
| `cfParameters`| Additional metadata for additional features. See  <a href="/TODO">TODO</a>.                                                      | `bytes`    |


```solidity
    // Swap native token
    function xSwapNative(
        uint32 dstChain,
        bytes calldata dstAddress,
        uint32 dstToken,
        bytes calldata cfParameters
    ) external payable;

    // Swap ERC20 token
    function xSwapToken(
        uint32 dstChain,
        bytes calldata dstAddress,
        uint32 dstToken,
        IERC20 srcToken,
        uint256 amount,
        bytes calldata cfParameters
    ) external;
```

#### Initiate swap with call to a receiver with cross-chain messaging (CCM)

Chainflip supports cross-chain messaging, calling a smart contract on the destination chain and passing a message between chains. The smart contract call looks very similar to the previous ones but with some added parameters.

For more information see [Cross-Chain Messaging](cross-chain-messaging/cross-chain-messaging.mdx). The swap could have originated in any supported chain, irrespective of whether the chain supports smart contracts.

<Callout type="warning">

Invalid parameters may lead to loss of funds. Make sure all parameters are correct, supported and follow the Chainflip protocol's nomenclature since reverting a transaction is not guaranteed.

</Callout>

| Param       | Description                                                                                                                   | Data Type  |
|-------------|-------------------------------------------------------------------------------------------------------------------------------|------------|
| `message`   | Message that is passed to the destination address on the destination chain. It must be shorter than 15k bytes.                | `bytes`    |
| `gasAmount` | Gas budget for the call on the destination chain in gas units or compute units. This amount should cover the execution of the receiver's logic. | `uint`     |


```solidity
    // Swap native token
    function xCallNative(
        uint32 dstChain,
        bytes calldata dstAddress,
        uint32 dstToken,
        bytes calldata message,
        uint256 gasAmount,
        bytes calldata cfParameters
    ) external payable;

    // Swap ERC20 token
    function xCallToken(
        uint32 dstChain,
        bytes calldata dstAddress,
        uint32 dstToken,
        bytes calldata message,
        uint256 gasAmount,
        IERC20 srcToken,
        uint256 amount,
        bytes calldata cfParameters
    ) external;
```